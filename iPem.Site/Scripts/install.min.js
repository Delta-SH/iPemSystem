(function(H){var c="ipems_install_config";var Q="ipems_install_status";var K="jQu3ry_5teps_St@te_wizard-panel";var D="<strong>\u7cfb\u7edf\u9519\u8bef:</strong> \u60a8\u7684\u6d4f\u89c8\u5668\u7981\u7528\u4e86Cookie\uff0c\u542f\u7528\u540e\u624d\u80fd\u4f7f\u7528\u672c\u5411\u5bfc\u3002";var p="<strong>\u7cfb\u7edf\u9519\u8bef:</strong> \u65e0\u6cd5\u83b7\u53d6Cookie\u5bf9\u8c61\u3002";var i="<strong>\u7cfb\u7edf\u9519\u8bef:</strong> Cookie\u5bf9\u8c61\u683c\u5f0f\u9519\u8bef\u3002";var P="IPv4\u5730\u5740\u683c\u5f0f\u9519\u8bef";var b="<strong>\u7cfb\u7edf\u9519\u8bef:</strong> ajax\u8bf7\u6c42\u65f6\u53d1\u751f\u9519\u8bef";var a="<strong>\u7cfb\u7edf\u9519\u8bef:</strong> ajax\u8fd4\u56de\u6570\u636e\u683c\u5f0f\u9519\u8bef";var N=200;var s={finish:"\u5b8c&nbsp;&nbsp;&nbsp;\u6210",next:"\u4e0b\u4e00\u6b65",previous:"\u4e0a\u4e00\u6b65"};var J={rs:0,cs:1,sc:2};var B={install:"\u5168\u65b0\u5b89\u88c5\u7cfb\u7edf",update:"\u5347\u7ea7\u539f\u6709\u7cfb\u7edf",created:"\u521b\u5efa\u5168\u65b0\u6570\u636e\u5e93",existed:"\u4f7f\u7528\u73b0\u6709\u6570\u636e\u5e93"};var j={waiting:{id:0,text:"\u7b49\u5f85"},install:{id:1,text:"\u6267\u884c"},success:{id:2,text:"\u5b8c\u6210"},failure:{id:3,text:"\u5931\u8d25"},cancel:{id:4,text:"\u53d6\u6d88"}};var o={rs:{index:0,status:j.waiting.id},cs:{index:1,status:j.waiting.id},sc:{index:2,status:j.waiting.id},role:{index:3,status:j.waiting.id},user:{index:4,status:j.waiting.id},finish:{index:5,status:j.waiting.id},success:{index:6,status:j.waiting.id},failure:{index:7,status:j.waiting.id}};var e=null;var y=null;H.ajaxSetup({type:"POST",cache:false,timeout:60000});function G(){if(y.length==0){return}if(e.length==0){return}switch(e.steps("getCurrentIndex")){case 0:z();break;case 1:x();break;case 2:w();break;case 3:u();break;case 4:q(false);t();break;default:break}}function z(){if(H.cookie){H.cookie.json=true;var S=H.cookie(c);if(typeof S!=="undefined"&&typeof S==="object"){H('input:radio[name*="welcome_iCheck"]').eq(S.type).iCheck("check")}}}function O(){var T=parseInt(H('input:radio[name*="welcome_iCheck"]:checked').val(),0);if(H.cookie){H.cookie.json=true;var S=H.cookie(c);if(typeof S!=="undefined"&&typeof S==="object"){S.type=T}else{var S={type:T,database:null,account:null}}H.cookie.json=true;H.cookie(c,S);return true}return false}function x(){if(H.cookie){H.cookie.json=true;var S=H.cookie(c);if(typeof S!=="undefined"&&typeof S==="object"&&S.database!=null){H.each(S.database,function(T,U){switch(U.id){case J.rs:H("#rsServerName").val(U.ipv4);H("#rsPort").val(U.port);H("#rsUid").val(U.uid);H("#rsPwd").val(U.pwd);H('input:radio[name*="Rs"]').eq(U.crdnew).iCheck("check");H("#rsNewDatabaseName").val(U.name);H("#rsNewDatabasePath").val(U.path);H("#rsExistingDatabaseName").val(U.oname);H("#rsDontCheckDatabase").iCheck(U.checked?"check":"uncheck");break;case J.cs:H("#csServerName").val(U.ipv4);H("#csPort").val(U.port);H("#csUid").val(U.uid);H("#csPwd").val(U.pwd);H('input:radio[name*="Cs"]').eq(U.crdnew).iCheck("check");H("#csNewDatabaseName").val(U.name);H("#csNewDatabasePath").val(U.path);H("#csExistingDatabaseName").val(U.oname);H("#csDontCheckDatabase").iCheck(U.checked?"check":"uncheck");break;case J.sc:H("#scServerName").val(U.ipv4);H("#scPort").val(U.port);H("#scUid").val(U.uid);H("#scPwd").val(U.pwd);H('input:radio[name*="Sc"]').eq(U.crdnew).iCheck("check");H("#scNewDatabaseName").val(U.name);H("#scNewDatabasePath").val(U.path);H("#scExistingDatabaseName").val(U.oname);H("#scDontCheckDatabase").iCheck(U.checked?"check":"uncheck");break;default:break}})}}}function M(){var U=H("#insform").valid();if(U&&H.cookie){var T=[{id:J.rs,ipv4:H("#rsServerName").val(),port:parseInt(H("#rsPort").val(),0),uid:H("#rsUid").val(),pwd:H("#rsPwd").val(),crdnew:parseInt(H('input:radio[name*="Rs"]:checked').val(),0),name:H("#rsNewDatabaseName").val(),path:H("#rsNewDatabasePath").val(),oname:H("#rsExistingDatabaseName").val(),checked:H("#rsDontCheckDatabase").is(":checked")},{id:J.cs,ipv4:H("#csServerName").val(),port:parseInt(H("#csPort").val(),0),uid:H("#csUid").val(),pwd:H("#csPwd").val(),crdnew:parseInt(H('input:radio[name*="Cs"]:checked').val(),0),name:H("#csNewDatabaseName").val(),path:H("#csNewDatabasePath").val(),oname:H("#csExistingDatabaseName").val(),checked:H("#csDontCheckDatabase").is(":checked")},{id:J.sc,ipv4:H("#scServerName").val(),port:parseInt(H("#scPort").val(),0),uid:H("#scUid").val(),pwd:H("#scPwd").val(),crdnew:parseInt(H('input:radio[name*="Sc"]:checked').val(),0),name:H("#scNewDatabaseName").val(),path:H("#scNewDatabasePath").val(),oname:H("#scExistingDatabaseName").val(),checked:H("#scDontCheckDatabase").is(":checked")}];H.cookie.json=true;var S=H.cookie(c);if(typeof S!=="undefined"&&typeof S==="object"){S.database=T}else{var S={type:0,database:T,account:null}}H.cookie.json=true;H.cookie(c,S);return true}return false}function w(){if(H.cookie){H.cookie.json=true;var S=H.cookie(c);if(typeof S!=="undefined"&&typeof S==="object"&&S.account!=null){H("#sysRoleName").val(S.account.role.name);H("#sysRoleCode").val(S.account.role.code);H("#sysRoleComment").val(S.account.role.comment);H("#sysUserName").val(S.account.user.name);H("#sysUserPwd").val(S.account.user.pwd);H("#sysUserComment").val(S.account.user.comment)}}}function L(){var U=H("#insform").valid();if(U&&H.cookie){var T={role:{name:H("#sysRoleName").val(),code:H("#sysRoleCode").val(),comment:H("#sysRoleComment").val()},user:{name:H("#sysUserName").val(),pwd:H("#sysUserPwd").val(),comment:H("#sysUserComment").val()}};H.cookie.json=true;var S=H.cookie(c);if(typeof S!=="undefined"&&typeof S==="object"){S.account=T}else{var S={type:0,database:null,account:T}}H.cookie.json=true;H.cookie(c,S);return true}return false}function u(){if(H.cookie){H.cookie.json=true;var S=H.cookie(c);if(typeof S!=="undefined"&&typeof S==="object"){if(S.type!=null){H("#cf-wc-01").html(S.type===0?B.install:B.update)}if(S.database!=null){H.each(S.database,function(T,U){switch(U.id){case J.rs:H("#cf-rs-01").html(U.ipv4);H("#cf-rs-02").html(U.port);H("#cf-rs-03").html(U.uid);H("#cf-rs-04").html(U.pwd);H("#cf-rs-05").html(U.crdnew===0?B.created:B.existed);H("#cf-rs-06").html(U.crdnew===0?U.name:U.oname);H("#cf-rs-07").html(U.crdnew===0?U.path:"undefined");break;case J.cs:H("#cf-cs-01").html(U.ipv4);H("#cf-cs-02").html(U.port);H("#cf-cs-03").html(U.uid);H("#cf-cs-04").html(U.pwd);H("#cf-cs-05").html(U.crdnew===0?B.created:B.existed);H("#cf-cs-06").html(U.crdnew===0?U.name:U.oname);H("#cf-cs-07").html(U.crdnew===0?U.path:"undefined");break;case J.sc:H("#cf-sc-01").html(U.ipv4);H("#cf-sc-02").html(U.port);H("#cf-sc-03").html(U.uid);H("#cf-sc-04").html(U.pwd);H("#cf-sc-05").html(U.crdnew===0?B.created:B.existed);H("#cf-sc-06").html(U.crdnew===0?U.name:U.oname);H("#cf-sc-07").html(U.crdnew===0?U.path:"undefined");break;default:break}})}if(S.account!=null){H("#cf-rl-01").html(S.account.role.name);H("#cf-rl-02").html(S.account.role.code);H("#cf-rl-03").html(S.account.role.comment);H("#cf-ue-01").html(S.account.user.name);H("#cf-ue-02").html(S.account.user.pwd);H("#cf-ue-03").html(S.account.user.comment)}}}}function t(){if(H.cookie){var S=parseInt(H.cookie(Q),0);if(!isNaN(S)){if(S==j.success.id){d(o.rs.index,j.success.id);d(o.cs.index,j.success.id);d(o.sc.index,j.success.id);d(o.role.index,j.success.id);d(o.user.index,j.success.id);d(o.finish.index,j.success.id);C();f()}else{if(S==j.failure.id){d(o.rs.index,j.failure.id);d(o.cs.index,j.failure.id);d(o.sc.index,j.failure.id);d(o.role.index,j.failure.id);d(o.user.index,j.failure.id);d(o.finish.index,j.failure.id);C();v()}}}}}function E(){try{if(!H.cookie){throw new Error(D)}H.cookie.json=true;var S=H.cookie(c);if(typeof S==="undefined"){throw new Error(p)}if(typeof S!=="object"){throw new Error(i)}r(S)}catch(T){g(T.message)}}function r(S){if(typeof S.database==="undefined"){throw new Error(i)}if(S.database==null){throw new Error(i)}H.each(S.database,function(T,U){if(U.id===J.rs){H.ajax({url:"/Installation/InstallRs",data:{type:S.type,data:JSON.stringify(U)},dataType:"json",beforeSend:function(V){d(o.rs.index,j.install.id)},error:function(V,X,W){I(o.rs.index,b)},success:function(X,Y,W){try{if(typeof X.code==="undefined"||typeof X.message==="undefined"){throw new Error(a)}if(X.code==N){d(o.rs.index,j.success.id);l(S)}else{throw new Error(X.message)}}catch(V){I(o.rs.index,V.message)}}});return false}})}function l(S){if(typeof S.database==="undefined"){throw new Error(i)}if(S.database==null){throw new Error(i)}H.each(S.database,function(T,U){if(U.id===J.cs){H.ajax({url:"/Installation/InstallCs",data:{type:S.type,data:JSON.stringify(U)},dataType:"json",beforeSend:function(V){d(o.cs.index,j.install.id)},error:function(V,X,W){I(o.cs.index,b)},success:function(X,Y,W){try{if(typeof X.code==="undefined"||typeof X.message==="undefined"){throw new Error(a)}if(X.code==N){d(o.cs.index,j.success.id);k(S)}else{throw new Error(X.message)}}catch(V){I(o.cs.index,V.message)}}});return false}})}function k(S){if(typeof S.database==="undefined"){throw new Error(i)}if(S.database==null){throw new Error(i)}H.each(S.database,function(T,U){if(U.id===J.sc){H.ajax({url:"/Installation/InstallSc",data:{type:S.type,data:JSON.stringify(U)},dataType:"json",beforeSend:function(V){d(o.sc.index,j.install.id)},error:function(V,X,W){I(o.sc.index,b)},success:function(X,Y,W){try{if(typeof X.code==="undefined"||typeof X.message==="undefined"){throw new Error(a)}if(X.code==N){d(o.sc.index,j.success.id);A(S)}else{throw new Error(X.message)}}catch(V){I(o.sc.index,V.message)}}});return false}})}function A(S){if(typeof S.account==="undefined"){throw new Error(i)}if(S.account==null){throw new Error(i)}H.ajax({url:"/Installation/InstallRl",data:{type:S.type,data:JSON.stringify(S.account.role)},dataType:"json",beforeSend:function(T){d(o.role.index,j.install.id)},error:function(T,V,U){I(o.role.index,b)},success:function(V,W,U){try{if(typeof V.code==="undefined"||typeof V.message==="undefined"){throw new Error(a)}if(V.code==N){d(o.role.index,j.success.id);F(S)}else{throw new Error(V.message)}}catch(T){I(o.role.index,T.message)}}})}function F(S){if(typeof S.account==="undefined"){throw new Error(i)}if(S.account==null){throw new Error(i)}H.ajax({url:"/Installation/InstallUe",data:{type:S.type,data:JSON.stringify(S.account.user)},dataType:"json",beforeSend:function(T){d(o.user.index,j.install.id)},error:function(T,V,U){I(o.user.index,b)},success:function(V,W,U){try{if(typeof V.code==="undefined"||typeof V.message==="undefined"){throw new Error(a)}if(V.code==N){d(o.user.index,j.success.id);n(S)}else{throw new Error(V.message)}}catch(T){I(o.user.index,T.message)}}})}function n(S){H.ajax({url:"/Installation/InstallFs",data:{type:S.type,data:""},dataType:"json",beforeSend:function(T){d(o.finish.index,j.install.id)},error:function(T,V,U){I(o.finish.index,b)},success:function(V,W,U){try{if(typeof V.code==="undefined"||typeof V.message==="undefined"){throw new Error(a)}if(V.code==N){d(o.finish.index,j.success.id);C();f()}else{throw new Error(V.message)}}catch(T){I(o.finish.index,T.message)}}})}function d(T,S){try{if(T>o.finish.index){throw new Error("Index out of range.")}var Z='<span class="label label-default"><span class="glyphicon glyphicon-time" aria-hidden="true"></span> '+j.waiting.text+"</span>",Y='<span class="label label-primary"><span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span> '+j.install.text+"</span>",X='<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> '+j.success.text+"</span>",W='<span class="label label-danger"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> '+j.failure.text+"</span>",U='<span class="label label-warning"><span class="glyphicon glyphicon-ban-circle" aria-hidden="true"></span> '+j.cancel.text+"</span>";var aa=H("#install-status tbody tr:eq("+T+") th");if(aa.length>0){switch(S){case j.waiting.id:aa.html(Z);break;case j.install.id:aa.html(Y);break;case j.success.id:aa.html(X);break;case j.failure.id:aa.html(W);break;case j.cancel.id:aa.html(U);break;default:break}}}catch(V){g(V.message)}}function I(S,T){switch(S){case o.rs.index:d(o.rs.index,j.failure.id);d(o.cs.index,j.cancel.id);d(o.sc.index,j.cancel.id);d(o.role.index,j.cancel.id);d(o.user.index,j.cancel.id);d(o.finish.index,j.cancel.id);break;case o.cs.index:d(o.cs.index,j.failure.id);d(o.sc.index,j.cancel.id);d(o.role.index,j.cancel.id);d(o.user.index,j.cancel.id);d(o.finish.index,j.cancel.id);break;case o.sc.index:d(o.sc.index,j.failure.id);d(o.role.index,j.cancel.id);d(o.user.index,j.cancel.id);d(o.finish.index,j.cancel.id);break;case o.role.index:d(o.role.index,j.failure.id);d(o.user.index,j.cancel.id);d(o.finish.index,j.cancel.id);break;case o.user.index:d(o.user.index,j.failure.id);d(o.finish.index,j.cancel.id);break;case o.finish.index:d(o.finish.index,j.failure.id);break;default:break}g(T);v();C();R()}function q(S){if(y.length==0){return}var T=y.find(".actions a[href$='#previous']").parent();T._showAria(S)}function m(S){if(y.length==0){return}var T=y.find(".actions a[href$='#next']").parent();T._showAria(S)}function g(S){H("#words").html(S);H("#alert").fadeIn(500)}function h(){H("#words").html("");H("#alert").fadeOut(500)}function f(){H("#success-panel").fadeIn(500);if(H.cookie){H.cookie(Q,j.success.id)}}function v(){H("#failure-panel").fadeIn(500);if(H.cookie){H.cookie(Q,j.failure.id)}}function R(){if(H.cookie){H.removeCookie(Q);H.removeCookie(K)}}function C(){if(e.length==0){return}e.steps("finish")}H(document).ready(function(){H(document).bind("contextmenu",function(S){return false});H(document).bind("keydown",function(S){S=window.event||S;if(S.keyCode==116){S.keyCode=0;return false}});y=H("#wizard-panel");e=y.steps({headerTag:"h1",bodyTag:"section",transitionEffect:"fade",enablePagination:true,enableFinishButton:false,autoFocus:true,saveState:true,forceMoveForward:false,labels:{finish:s.finish,next:s.next,previous:s.previous},onStepChanging:function(U,S,T){if(S===4){return false}q(T<4);if(S>T){return true}if(!H.cookie){g(D);return false}h();switch(S){case 0:return O();case 1:return M();case 2:return L();default:break}return true},onStepChanged:function(T,S,U){switch(S){case 0:z();break;case 1:x();break;case 2:w();break;case 3:u();break;case 4:E();break;default:break}},onCanceled:function(S){},onFinishing:function(T,S){return true},onFinished:function(T,S){}});H(".icheck-radio-list input").each(function(){var S=H(this),T=S.next(),U=T.text();T.remove();S.iCheck({checkboxClass:"icheckbox_line-blue",radioClass:"iradio_line-blue",insert:'<div class="icheck_line-icon"></div>'+U})});H(".icheck-radio-group input").each(function(){H(this).iCheck({checkboxClass:"icheckbox_flat-blue",radioClass:"iradio_flat-blue"})});H('input:radio[name*="Rs"]').on("ifChecked",function(U){var Z=H('input:radio[name*="Rs"]:checked').val();switch(parseInt(Z,0)){case 0:H("#rsNewDatabaseName").removeAttr("disabled");H("#rsNewDatabasePath").removeAttr("disabled");H("#rsDontCheckDatabase").iCheck("disable");var W=H("#rsExistingDatabaseName");W.attr("disabled","disabled");var Y=W.closest(".input-group");if(Y.hasClass("has-error")){Y.removeClass("has-error");Y.next().html("")}break;case 1:H("#rsExistingDatabaseName").removeAttr("disabled");H("#rsDontCheckDatabase").iCheck("enable");var T=H("#rsNewDatabaseName");T.attr("disabled","disabled");var X=T.closest(".input-group");if(X.hasClass("has-error")){X.removeClass("has-error");X.next().html("")}var S=H("#rsNewDatabasePath");S.attr("disabled","disabled");var V=S.closest(".input-group");if(V.hasClass("has-error")){V.removeClass("has-error");V.next().html("")}break;default:break}});H('input:radio[name*="Cs"]').on("ifChecked",function(U){var Z=H('input:radio[name*="Cs"]:checked').val();switch(parseInt(Z,0)){case 0:H("#csNewDatabaseName").removeAttr("disabled");H("#csNewDatabasePath").removeAttr("disabled");H("#csDontCheckDatabase").iCheck("disable");var W=H("#csExistingDatabaseName");W.attr("disabled","disabled");var Y=W.closest(".input-group");if(Y.hasClass("has-error")){Y.removeClass("has-error");Y.next().html("")}break;case 1:H("#csExistingDatabaseName").removeAttr("disabled");H("#csDontCheckDatabase").iCheck("enable");var T=H("#csNewDatabaseName");T.attr("disabled","disabled");var X=T.closest(".input-group");if(X.hasClass("has-error")){X.removeClass("has-error");X.next().html("")}var S=H("#csNewDatabasePath");S.attr("disabled","disabled");var V=S.closest(".input-group");if(V.hasClass("has-error")){V.removeClass("has-error");V.next().html("")}break;default:break}});H('input:radio[name*="Sc"]').on("ifChecked",function(U){var Z=H('input:radio[name*="Sc"]:checked').val();switch(parseInt(Z,0)){case 0:H("#scNewDatabaseName").removeAttr("disabled");H("#scNewDatabasePath").removeAttr("disabled");H("#scDontCheckDatabase").iCheck("disable");var W=H("#scExistingDatabaseName");W.attr("disabled","disabled");var Y=W.closest(".input-group");if(Y.hasClass("has-error")){Y.removeClass("has-error");Y.next().html("")}break;case 1:H("#scExistingDatabaseName").removeAttr("disabled");H("#scDontCheckDatabase").iCheck("enable");var T=H("#scNewDatabaseName");T.attr("disabled","disabled");var X=T.closest(".input-group");if(X.hasClass("has-error")){X.removeClass("has-error");X.next().html("")}var S=H("#scNewDatabasePath");S.attr("disabled","disabled");var V=S.closest(".input-group");if(V.hasClass("has-error")){V.removeClass("has-error");V.next().html("")}break;default:break}});H("#insform").validate({rules:{rsServerName:{ipv4:true},rsPort:{required:true,digits:true,max:65535,min:1},csServerName:{ipv4:true},csPort:{required:true,digits:true,max:65535,min:1},scServerName:{ipv4:true},scPort:{required:true,digits:true,max:65535,min:1}},messages:{rsServerName:{ipv4:P},csServerName:{ipv4:P},scServerName:{ipv4:P}},errorElement:"span",highlight:function(S){var T=H(S).closest(".input-group");if(!T.hasClass("has-error")){T.addClass("has-error")}},errorPlacement:function(S,T){S.appendTo(T.parent().next())},success:function(S,T){var U=H(T).closest(".input-group");if(U.hasClass("has-error")){U.removeClass("has-error")}}});G()})})(jQuery);
