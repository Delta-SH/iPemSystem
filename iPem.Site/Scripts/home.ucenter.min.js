(function(){Ext.apply(Ext.form.VTypes,{password:function(f,e){if(e.confirmTo){var d=e.ownerCt.getComponent(e.confirmTo);if(!Ext.isEmpty(d)){return(f==d.getValue())}}return true}});var c=Ext.create("Ext.tab.Panel",{border:true,flex:1,cls:"x-custom-panel",plain:true,loader:{url:"/Account/GetCurrentUser",autoLoad:false,loadMask:true,renderer:function(f,g,j){var k=Ext.decode(g.responseText,true);if(k.success){var i=Ext.getCmp("base-info-left"),e=Ext.getCmp("base-info-right"),h=Ext.getCmp("changePassword");var d=k.data;if(!Ext.isEmpty(d)&&Ext.isObject(d)){i.getComponent("uid").setValue(d.uid);i.getComponent("empName").setValue(d.empName);i.getComponent("sexName").setValue(d.sexName);i.getComponent("email").setValue(d.email);i.getComponent("limited").setValue(d.limited);i.getComponent("lastLockedout").setValue(d.lastLockedout);i.getComponent("comment").setValue(d.comment);e.getComponent("roleName").setValue(d.roleName);e.getComponent("empNo").setValue(d.empNo);e.getComponent("mobile").setValue(d.mobile);e.getComponent("created").setValue(d.created);e.getComponent("isLockedOut").setValue(d.isLockedOut?"\u9501\u5b9a":"\u6b63\u5e38");e.getComponent("lastPasswordChanged").setValue(d.lastPasswordChanged);h.getComponent("id").setValue(d.id);h.getComponent("uid").setValue(d.uid)}}}},items:[{title:"\u57fa\u672c\u4fe1\u606f",glyph:61458,layout:"hbox",items:[{xtype:"container",width:100,items:[{xtype:"image",height:80,width:80,margin:"25 0 0 20",src:"/Account/GetCurrentPhoto"}]},{xtype:"container",id:"base-info-left",flex:1,layout:"anchor",defaults:{anchor:"100%",labelWidth:80,margin:20},items:[{xtype:"displayfield",itemId:"uid",fieldLabel:"\u767b\u5f55\u7528\u6237"},{xtype:"displayfield",itemId:"empName",fieldLabel:"\u96b6\u5c5e\u5458\u5de5"},{xtype:"displayfield",itemId:"sexName",fieldLabel:"\u6027&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u522b"},{xtype:"displayfield",itemId:"email",fieldLabel:"Email"},{xtype:"displayfield",itemId:"limited",fieldLabel:"\u6709\u6548\u65e5\u671f"},{xtype:"displayfield",itemId:"lastLockedout",fieldLabel:"\u9501\u5b9a\u65e5\u671f"},{xtype:"displayfield",itemId:"comment",fieldLabel:"\u5907\u6ce8\u4fe1\u606f"}]},{xtype:"container",id:"base-info-right",flex:1,layout:"anchor",defaults:{anchor:"100%",labelWidth:80,margin:"20 25 20 25"},items:[{xtype:"displayfield",itemId:"roleName",fieldLabel:"\u96b6\u5c5e\u89d2\u8272"},{xtype:"displayfield",itemId:"empNo",fieldLabel:"\u5458\u5de5\u5de5\u53f7"},{xtype:"displayfield",itemId:"mobile",fieldLabel:"\u8054\u7cfb\u7535\u8bdd"},{xtype:"displayfield",itemId:"created",fieldLabel:"\u521b\u5efa\u65e5\u671f"},{xtype:"displayfield",itemId:"isLockedOut",fieldLabel:"\u9501\u5b9a\u72b6\u6001"},{xtype:"displayfield",itemId:"lastPasswordChanged",fieldLabel:"\u66f4\u65b0\u5bc6\u7801"},]}]},{title:"\u4fee\u6539\u5bc6\u7801",glyph:61474,items:[{id:"changePassword",xtype:"form",border:false,defaultType:"textfield",fieldDefaults:{labelWidth:60,labelAlign:"left",margin:"25 25 25 25",width:360},items:[{itemId:"id",xtype:"hiddenfield",value:""},{itemId:"uid",xtype:"textfield",readOnly:true,fieldLabel:"\u767b\u5f55\u7528\u6237",allowBlank:false},{itemId:"origin",xtype:"textfield",inputType:"password",fieldLabel:"\u539f\u59cb\u5bc6\u7801",allowBlank:false},{itemId:"password",xtype:"textfield",inputType:"password",fieldLabel:"\u65b0\u7684\u5bc6\u7801",allowBlank:false},{itemId:"confirmPassword",xtype:"textfield",inputType:"password",fieldLabel:"\u786e\u8ba4\u5bc6\u7801",allowBlank:false,vtype:"password",vtypeText:"\u5bc6\u7801\u4e0d\u4e00\u81f4",confirmTo:"password"}]}],buttonAlign:"left",buttons:[{xtype:"button",text:"\u4fdd\u5b58\u5bc6\u7801",cls:"custom-button custom-success",handler:function(){var f=Ext.getCmp("changePassword"),e=f.getForm(),g=f.getComponent("id").getValue(),d=Ext.getCmp("changeResult");d.setTextWithIcon("","");if(e.isValid()&&!Ext.isEmpty(g)){Ext.Msg.confirm("\u786e\u8ba4\u5bf9\u8bdd\u6846","\u60a8\u786e\u8ba4\u8981\u4fee\u6539\u5bc6\u7801\u5417\uff1f",function(j,k){if(j==="yes"){d.setTextWithIcon("\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u540e...","x-icon-loading");var h=f.getComponent("origin").getValue();var i=f.getComponent("password").getValue();e.submit({submitEmptyText:false,clientValidation:true,preventWindow:true,url:"/Account/ChangePassword",params:{id:g,origin:h,password:i},success:function(l,m){d.setTextWithIcon(m.result.message,"x-icon-accept")},failure:function(m,n){var l="undefined error.";if(!Ext.isEmpty(n.result)&&!Ext.isEmpty(n.result.message)){l=n.result.message}d.setTextWithIcon(l,"x-icon-error")}})}})}else{d.setTextWithIcon("\u8868\u5355\u586b\u5199\u9519\u8bef","x-icon-error")}}},{id:"changeResult",xtype:"iconlabel",text:""}]}]});var a=Ext.create("Ext.panel.Panel",{title:"\u767b\u51fa\u7cfb\u7edf",collapsible:true,cls:"x-danger-panel",margin:"10 0 0 0",glyph:61478,border:true,bodyPadding:10,items:[{xtype:"container",contentEl:"logout-content"}]});var b=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"stretch",pack:"start",},region:"center",border:false,items:[c,a]});Ext.onReady(function(){var d=Ext.getCmp("center-content-panel-fw");if(!Ext.isEmpty(d)){d.add(b);c.getLoader().load()}})})();
