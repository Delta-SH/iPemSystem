(function(){Ext.define("NoticeModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"title",type:"string"},{name:"content",type:"string"},{name:"created",type:"string"},{name:"readed",type:"boolean"},{name:"readtime",type:"string"}],idProperty:"id"});var a=Ext.create("Ext.data.Store",{autoLoad:false,pageSize:20,model:"NoticeModel",proxy:{type:"ajax",url:"/Home/GetNotices",reader:{type:"json",successProperty:"success",messageProperty:"message",totalProperty:"total",root:"data"},listeners:{exception:function(j,i,h){Ext.Msg.show({title:"\u7cfb\u7edf\u9519\u8bef",msg:h.getError(),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}},extraParams:{listModel:"all"},simpleSortMode:true}});var g=$$iPems.clonePagingToolbar(a);var e=function(){var h=Ext.getCmp("unread"),i=Ext.getCmp("readed");var j="all";if(h.pressed){j="unread"}else{if(i.pressed){j="readed"}}a.getProxy().extraParams.listModel=j;a.loadPage(1)};var f=Ext.create("Ext.window.Window",{title:"Detail",glyph:61476,height:250,width:400,modal:true,border:false,hidden:true,closeAction:"hide",bodyPadding:10,layout:"form",items:[{itemId:"notice-detail",xtype:"label",text:""},{xtype:"component",height:5},{itemId:"notice-created",xtype:"label",text:""}],buttonAlign:"right",buttons:[{xtype:"button",text:"\u5173\u95ed",handler:function(h,i){f.hide()}}]});var d=Ext.create("Ext.grid.Panel",{glyph:61477,title:"\u7cfb\u7edf\u6d88\u606f\u5217\u8868",region:"center",store:a,columnLines:true,selType:"checkboxmodel",disableSelection:false,loadMask:true,forceFit:false,viewConfig:{forceFit:true,trackOver:true,stripeRows:true,emptyText:'<h1 style="margin:20px">\u6ca1\u6709\u6570\u636e\u8bb0\u5f55</h1>',preserveScrollOnRefresh:true},columns:[{text:"\u6d88\u606f\u6807\u9898",dataIndex:"title",flex:1,align:"left",sortable:true,renderer:function(m,j,i,n,l,k,h){if(!i.raw.readed){return'<span style="font-weight:bold;">'+m+"</span>"}return m}},{text:"\u6d88\u606f\u65e5\u671f",dataIndex:"created",width:200,align:"center",sortable:true,renderer:function(m,j,i,n,l,k,h){if(!i.raw.readed){return'<span style="font-weight:bold;">'+m+"</span>"}return m}},{xtype:"actioncolumn",width:50,align:"center",menuDisabled:true,menuText:"\u64cd\u4f5c",text:"\u64cd\u4f5c",items:[{iconCls:"x-cell-icon x-icon-detail",handler:function(j,k,i){var h=j.getStore().getAt(k);if(Ext.isEmpty(h)){return false}c(h)}}]}],tbar:Ext.create("Ext.toolbar.Toolbar",{items:[{id:"unread",xtype:"button",text:"\u672a\u8bfb\u6d88\u606f",enableToggle:true,glyph:61477,toggleGroup:"notice",handler:function(h,i){e()}},"-",{id:"readed",xtype:"button",text:"\u5df2\u8bfb\u6d88\u606f",enableToggle:true,toggleGroup:"notice",glyph:61476,handler:function(h,i){e()}},"-",{xtype:"button",text:"\u6279\u91cf\u64cd\u4f5c",glyph:61448,menu:Ext.create("Ext.menu.Menu",{plain:true,border:false,items:[{text:"\u6807\u8bb0\u4e3a\u5df2\u8bfb",glyph:61476,handler:function(){var i=d.getSelectionModel().getSelection();var h=[];Ext.Array.each(i,function(k,j){Ext.Array.push(h,k.data.id)});if(h.length>0){b(h,"readed")}}},"-",{text:"\u6807\u8bb0\u4e3a\u672a\u8bfb",glyph:61477,handler:function(){var i=d.getSelectionModel().getSelection();var h=[];Ext.Array.each(i,function(k,j){Ext.Array.push(h,k.data.id)});if(h.length>0){b(h,"unread")}}}]})}]}),bbar:g,listeners:{itemdblclick:function(i,h,k,j,l){c(h)}}});var c=function(h){Ext.Ajax.request({url:"/Home/SetNotices",Method:"POST",mask:Ext.create("Ext.LoadMask",{target:d,msg:"\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u540e..."}),params:{notices:[h.raw.id],status:"readed"},success:function(i,j){var l=Ext.decode(i.responseText,true);if(l.success){var k=f.getComponent("notice-detail");var m=f.getComponent("notice-created");k.setText(h.raw.content);m.setText(h.raw.created);f.setTitle(h.raw.title);f.show();g.doRefresh()}else{Ext.Msg.show({title:"\u7cfb\u7edf\u9519\u8bef",msg:l.message,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}})};var b=function(i,h){Ext.Ajax.request({url:"/Home/SetNotices",Method:"POST",mask:Ext.create("Ext.LoadMask",{target:d,msg:"\u6b63\u5728\u5904\u7406\uff0c\u8bf7\u7a0d\u540e..."}),params:{notices:i,status:h},success:function(j,k){var l=Ext.decode(j.responseText,true);if(l.success){g.doRefresh()}else{Ext.Msg.show({title:"\u7cfb\u7edf\u9519\u8bef",msg:l.message,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}})};Ext.onReady(function(){var h=Ext.getCmp("center-content-panel-fw");if(!Ext.isEmpty(h)){h.add(d);a.load()}})})();
